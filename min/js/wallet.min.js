const PEPETONE={CONNECT:"Connect Wallet",ATCONNECT:"Connect Your Wallet First!",DEPOSIT:"Deposit",PRSTART:"Starting in: ",NOTSTART:"Presale has not started",WAIT:"Waitting...",ERRORS:{NAN:"Please enter a number",NOTINRANG:"Please enter a number within ",INSUFFICIENTFONDS:"insufficient funds for transfer",ACCOUNTNOTFOUND:"Can't get the correct account.",NETWORK:"Network Error!",WALLET:" is not installed correctly"},RATIO:"Fixed Swap Ratio:",MINMAX:"Minimum/Maximum:",PROGRESS:"Auction progress:",SELECTWALLET:"Choose a Wallet Provider"};function PEPEWORKER(){const e={chainId:97,networkId:97,provider:"https://bsc-dataseed.binance.org/",scan:"https://api.bscscan.com",time:"2021-05-21T08:00:00Z"};let t={};const n="BSC",a="MM",s={addr:"0xCB4FE28357333f0E3ffAfd48A6dCd147CE3416c2",decimal:18,ratio:6666,max:3,min:.1,required:2250,abi:[{inputs:[{internalType:"contract IERC20",name:"_token",type:"address"},{internalType:"address payable",name:"_fundingAddress",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"recepient",type:"address"},{indexed:!1,internalType:"uint256",name:"tokensSold",type:"uint256"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"SellToken",type:"event"},{inputs:[],name:"getTime",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getToken",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"isActive",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"isSuccessful",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"returnUnsold",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"stop",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"totalCollected",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalTokensNeeded",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"unstop",outputs:[],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"}],startTime:+new Date(e.time).getTime(),endTime:+new Date("2021-05-23T08:00:00Z").getTime()};let i;const o=(t=e.provider)=>(null!=i&&"string"==typeof t||("string"==typeof t&&(t=new Web3.providers.HttpProvider(t)),i=new Web3(t)),i);class r{constructor(e,t){this.name=e,Object.assign(this,t)}disable(){throw"Please implement the method"}enable(){throw"Please implement the method"}}class d extends r{checkDisabled(){const e=$(this.name).prop("disabled");return!(null==e||"false"==e||0==e)}disable(e){this.checkDisabled()||($(this.name).prop("disabled",!0),e&&$(this.name).html(e))}enable(e){this.checkDisabled()&&($(this.name).prop("disabled",!1),e&&$(this.name).html(e))}}const l=async t=>{const n=(await fetch(`${e.scan}/api?module=account&action=txlist&address=${t}&startblock=7340206&endblock=99999999&sort=asc`).then((e=>e.json()))).result||[];let a=0;for await(tx of n)if(tx.to==s.addr.toLowerCase()){const e=o().utils.fromWei(tx.value);a+=Number(e)}$(".deposited > span").html(a.toFixed(2)),a>s.max&&p.disable("Hooray! $PEPE is on the way.")},c=new d("button.connector",{setAction:function(e,t){"display"==e?$(this.name).html(t.substring(0,10)+"..."+t.substring(t.length-4)):"unloggin"==e?$(this.name).html(PEPETONE.CONNECT):console.error("unhandled action: ",e)}}),p=new d("button.deposit",{setAction:function(e){"openModal"==e?h.bindFor(this.name,(e=>e.html(PEPETONE.ATCONNECT).off("click"))):"deposit"==e?$(this.name).attr("data-toggle","").attr("data-target","").html(PEPETONE.DEPOSIT).on("click",y):console.error("unhandled action: ",e)}}),u=new r(".req-disable",{disable:function(){$(this.name).addClass("disabled")},enable:function(){$(this.name).addClass("non-disabled").removeClass("disabled")}}),m=new r(".rest-balance",{setBalance:function(e=0){this.balance=e,$(this.name).html(e.toFixed(3))},getBalance:function(){w(),w(t.curAddr).then((e=>m.setBalance(e)))}}),h=new class extends r{constructor(...e){super(...e),this.id=this.name.substring(1)}disable(){$(this.name).modal("hide")}}("#accounts",{bindFor:function(e,t){e=$(e).attr("data-toggle","modal").attr("data-target",this.name),t&&t(e)}}),E=new r(".rest-time",{tick:function(e=0,t=!1){$(this.name).html($.duration((new Date).getTime(),e));const n=$(this.name).attr("data-disable");if(t&&!n){$(".time-hit").html(PEPETONE.PRSTART),$(this.name).attr("data-disable",!0);const e=$(this.name).parents();$(e[0]).css("font-size","2rem"),$(e[1]).next().remove()}}}),b=(e=0)=>o().utils.toHex(o().utils.toWei(e.toString(),"ether")),y=async()=>{const n=parseFloat($(".deposit-num").val());p.disable(PEPETONE.WAIT);const a=e=>({message:"err:"+e});try{if(!n||Number.isNaN(n))throw a(PEPETONE.ERRORS.NAN);if(n>s.max||n<s.min)throw a(PEPETONE.ERRORS.NOTINRANG+s.min+" - "+s.max);const i=await o().eth.getTransactionCount(t.curAddr),r=await o().eth.getGasPrice();if(console.log(Number(await o().utils.fromWei(r))+n),Number(await o().utils.fromWei(r))+n>m.balance)throw a(PEPETONE.ERRORS.INSUFFICIENTFONDS);await o().eth.sendTransaction({nonce:i,from:t.curAddr,to:s.addr,value:b(n),gasPrice:r,common:{customChain:{name:"bsc",networkId:e.networkId,chainId:e.chainId}}})}catch(e){console.error(e),appendError("Deposit Error: "+e?.message?.split(":")[1]),appendError("Try improve gas limit (example 21,000,000)")}finally{p.enable(PEPETONE.DEPOSIT),m.getBalance(),await l(t.curAddr)}},T=(e="")=>{console.log("account:",e),t.curAddr=e;try{""!=e&&e?(l(e),h.disable(),c.setAction("display",e),p.setAction("deposit"),u.enable(),w(e).then((e=>m.setBalance(e)))):(c.setAction("unloggin"),p.setAction("openModal"),u.disable(),m.setBalance(0))}catch(e){console.error(e),appendError(PEPETONE.ERRORS.ACCOUNTNOTFOUND)}},w=async(e=s.addr)=>{const t=await o().eth.getBalance(e)/Math.pow(10,s.decimal);return console.log("cur progress",t),e==s.addr&&($(".cur-presaled").html(t.toFixed(1)),$("div.progress-bar").css({width:t/s.required+"%"}).attr("aria-valuenow",t)),t};let N={openOrNot:function(){let e=(new Date).getTime();return e>s.startTime&&e<s.endTime},opend:function(){E.tick(s.endTime)},notOpen:function(){N.openOrNot()&&(clearInterval(N.interval),window.location.reload()),E.tick(s.startTime,!0),p.disable(PEPETONE.NOTSTART),c.disable(PEPETONE.NOTSTART)}};$(document.body).prepend(`<div class="modal fade" id="${h.id}"\ntabindex="-1" role="dialog" aria-labelledby="accountsLabel"\naria-hidden="true">\n<div class="modal-dialog modal-dialog-centered" role="document">\n <div class="modal-content">\n <div class="modal-header">\n <h5 class="modal-title" id="accountsLabel">${PEPETONE.SELECTWALLET}</h5>\n <button\n type="button"\n class="close"\n data-dismiss="modal"\n aria-label="Close"\n >\n <span aria-hidden="true">&times;</span>\n </button>\n </div>\n <div class="modal-body row align-items-streach">\n <button class="btn wallet-provider p-4 metamask mr-2">\n <img src="./assets/pateners/metamask.svg" />\n <span class="formal text-info mt-2">MetaMask</span>\n </button>\n <button class="btn wallet-provider p-4 bsc">\n <img src="./assets/bsc-wallet.jpg" />\n <span class="formal text-info mt-2">BSC Wallet</span>\n </button>\n </div>\n </div>\n</div>\n</div>`),$("div.info").append(`<div class="card-body formal">\n<h4 class="card-title">Presale Info</h4>\n<div class="card-text">\n <p class="text-info text-left" style="font-size: 1.125em">${PEPETONE.RATIO}&nbsp;</p>\n <p class="text-right">${s.ratio} PEPE = 1 BNB</p>\n <hr />\n <p class="text-info text-left" style="font-size: 1.125em">${PEPETONE.MINMAX}</p>\n <p class="text-right">${s.min} BNB / ${s.max} BNB</p>\n</div>\n<div class="btn">${PEPETONE.PROGRESS}&nbsp;<span class="cur-presaled">0.0</span> BNB / ${s.required} BNB</div>\n<div class="progress" style="height: 0.5rem">\n <div\n class="progress-bar progress-bar-animated progress-bar-striped"\n role="progressbar"\n style="width: 25%"\n aria-valuenow="25"\n aria-valuemin="0"\n aria-valuemax="${s.required}"\n ></div>\n</div>\n</div>`),window.ethereum?.on("disconnect",(()=>T())),window.BinanceChain?.on("disconnect",(()=>T())),window.ethereum?.on("accountsChanged",(()=>T())),window.BinanceChain?.on("accountsChanged",(()=>T())),window.ethereum?.on("chainChanged",(()=>T())),window.BinanceChain?.on("chainChanged",(e=>T())),$((function(){T(),N.openOrNot()?(N.opend(),N.interval=setInterval(N.opend,1e3)):(N.notOpen(),N.interval=setInterval(N.notOpen,1e3)),w().catch((e=>{console.error(e),appendError(PEPETONE.ERRORS.NETWORK)}))})),$("button.metamask").on("click",(async()=>{try{o(window.ethereum);const e=(await window.ethereum.request({method:"eth_requestAccounts"}))[0];t.user=e,t.type=a,T(e)}catch(e){console.error(e),appendError("MetaMask"+PEPETONE.ERRORS.WALLET)}})),$("button.bsc").on("click",(async()=>{try{o(window.BinanceChain);const e=(await window.BinanceChain.requestAccounts())[0];t.user=e,t.type=n,T(e.addresses.filter((e=>"eth"==e.type))[0].address)}catch(e){console.error(e),appendError("BSC-Wallet"+PEPETONE.ERRORS.WALLET)}}))}PEPEWORKER();