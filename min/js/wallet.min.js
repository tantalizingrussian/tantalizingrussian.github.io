const PEPETONE={CONNECT:"Connect Wallet",ATCONNECT:"Connect Your Wallet First!",DEPOSIT:"Deposit",PRSTART:"Starting in: ",NOTSTART:"Presale has not started",WAIT:"Waitting...",ERRORS:{NAN:"Please enter a number",NOTINRANG:"Please enter a number within ",INSUFFICIENTFONDS:"insufficient funds for transfer",ACCOUNTNOTFOUND:"Can't get the correct account.",NETWORK:"Network Error!",WALLET:" is not installed correctly"},RATIO:"Fixed Swap Ratio:",MINMAX:"Minimum/Maximum:",PROGRESS:"Auction progress:",SELECTWALLET:"Choose a Wallet Provider"};function PEPEWORKER(){const e={chainId:97,networkId:97,provider:"https://bsc-dataseed.binance.org/",scan:"https://api.bscscan.com",time:"2022-05-17T15:00:00Z"};let t=[],n={};const a="BSC",s="MM",i={addr:"",decimal:18,ratio:6666,max:5,min:.5,required:500,abi:[{inputs:[{internalType:"contract IERC20",name:"_token",type:"address"},{internalType:"address payable",name:"_fundingAddress",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"recepient",type:"address"},{indexed:!1,internalType:"uint256",name:"tokensSold",type:"uint256"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"SellToken",type:"event"},{inputs:[],name:"getTime",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getToken",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"isActive",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"isSuccessful",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"returnUnsold",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"stop",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"totalCollected",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalTokensNeeded",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"unstop",outputs:[],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"}],startTime:+new Date(e.time).getTime(),endTime:+new Date("2022-05-19T15:00:00Z").getTime()},o=e=>{t.push(t.length+1),$(document.body).prepend(`<div class="alert alert-warning fade show formal" stack="${t.length}"\n role="alert" style="bottom: calc(10px + ${42*(t.length-1)}px);">\n ${e}\n </div>`);const n=setTimeout((()=>{$(`div.alert[stack=${t[0]}]`).alert("close"),clearTimeout(n),t.shift()}),5e3)};let r;const l=(t=e.provider)=>(null!=r&&"string"==typeof t||("string"==typeof t&&(t=new Web3.providers.HttpProvider(t)),r=new Web3(t)),r);class d{constructor(e,t){this.name=e,Object.assign(this,t)}disable(){throw"Please implement the method"}enable(){throw"Please implement the method"}}class c extends d{checkDisabled(){const e=$(this.name).prop("disabled");return!(null==e||"false"==e||0==e)}disable(e){this.checkDisabled()||($(this.name).prop("disabled",!0),e&&$(this.name).html(e))}enable(e){this.checkDisabled()&&($(this.name).prop("disabled",!1),e&&$(this.name).html(e))}}const u=async t=>{const n=(await fetch(`${e.scan}/api?module=account&action=txlist&address=${t}&startblock=7340206&endblock=99999999&sort=asc`).then((e=>e.json()))).result||[];let a=0;for await(tx of n)if(tx.to==i.addr.toLowerCase()){const e=l().utils.fromWei(tx.value);a+=Number(e)}$(".deposited > span").html(a.toFixed(2)),a>i.max&&m.disable("Hooray! $PEPE is on the way.")},p=new c("button.connector",{setAction:function(e,t){"display"==e?$(this.name).html(t.substring(0,10)+"..."+t.substring(t.length-4)):"unloggin"==e?$(this.name).html(PEPETONE.CONNECT):console.error("unhandled action: ",e)}}),m=new c("button.deposit",{setAction:function(e){"openModal"==e?E.bindFor(this.name,(e=>e.html(PEPETONE.ATCONNECT).off("click"))):"deposit"==e?$(this.name).attr("data-toggle","").attr("data-target","").html(PEPETONE.DEPOSIT).on("click",w):console.error("unhandled action: ",e)}}),h=new d(".req-disable",{disable:function(){$(this.name).addClass("disabled")},enable:function(){$(this.name).addClass("non-disabled").removeClass("disabled")}}),b=new d(".rest-balance",{setBalance:function(e=0){this.balance=e,$(this.name).html(e.toFixed(3))},getBalance:function(){f(),f(n.curAddr).then((e=>b.setBalance(e)))}}),E=new class extends d{constructor(...e){super(...e),this.id=this.name.substring(1)}disable(){$(this.name).modal("hide")}}("#accounts",{bindFor:function(e,t){e=$(e).attr("data-toggle","modal").attr("data-target",this.name),t&&t(e)}}),y=new d(".rest-time",{tick:function(e=0,t=!1){$(this.name).html($.duration((new Date).getTime(),e));const n=$(this.name).attr("data-disable");if(t&&!n){$(".time-hit").html(PEPETONE.PRSTART),$(this.name).attr("data-disable",!0);const e=$(this.name).parents();$(e[0]).css("font-size","2rem"),$(e[1]).next().remove()}}}),T=(e=0)=>l().utils.toHex(l().utils.toWei(e.toString(),"ether")),w=async()=>{const t=parseFloat($(".deposit-num").val());m.disable(PEPETONE.WAIT);const a=e=>({message:"err:"+e});try{if(!t||Number.isNaN(t))throw a(PEPETONE.ERRORS.NAN);if(t>i.max||t<i.min)throw a(PEPETONE.ERRORS.NOTINRANG+i.min+" - "+i.max);const s=await l().eth.getTransactionCount(n.curAddr),o=await l().eth.getGasPrice();if(console.log(Number(await l().utils.fromWei(o))+t),Number(await l().utils.fromWei(o))+t>b.balance)throw a(PEPETONE.ERRORS.INSUFFICIENTFONDS);await l().eth.sendTransaction({nonce:s,from:n.curAddr,to:i.addr,value:T(t),gasPrice:o,common:{customChain:{name:"bsc",networkId:e.networkId,chainId:e.chainId}}})}catch(e){console.error(e),o("Deposit Error: "+e?.message?.split(":")[1])}finally{m.enable(PEPETONE.DEPOSIT),b.getBalance(),await u(n.curAddr)}},N=(e="")=>{console.log("account:",e),n.curAddr=e;try{""!=e&&e?(u(e),E.disable(),p.setAction("display",e),m.setAction("deposit"),h.enable(),f(e).then((e=>b.setBalance(e)))):(p.setAction("unloggin"),m.setAction("openModal"),h.disable(),b.setBalance(0))}catch(e){console.error(e),o(PEPETONE.ERRORS.ACCOUNTNOTFOUND)}},f=async(e=i.addr)=>{const t=await l().eth.getBalance(e)/Math.pow(10,i.decimal);return console.log("cur progress",t),e==i.addr&&($(".cur-presaled").html(t.toFixed(1)),$("div.progress-bar").css({width:t/i.required+"%"}).attr("aria-valuenow",t)),t};let O={openOrNot:function(){let e=(new Date).getTime();return e>i.startTime&&e<i.endTime},opend:function(){y.tick(i.endTime)},notOpen:function(){O.openOrNot()&&(clearInterval(O.interval),window.location.reload()),y.tick(i.startTime,!0),m.disable(PEPETONE.NOTSTART),p.disable(PEPETONE.NOTSTART)}};$(document.body).prepend(`<div class="modal fade" id="${E.id}"\ntabindex="-1" role="dialog" aria-labelledby="accountsLabel"\naria-hidden="true">\n<div class="modal-dialog modal-dialog-centered" role="document">\n <div class="modal-content">\n <div class="modal-header">\n <h5 class="modal-title" id="accountsLabel">${PEPETONE.SELECTWALLET}</h5>\n <button\n type="button"\n class="close"\n data-dismiss="modal"\n aria-label="Close"\n >\n <span aria-hidden="true">&times;</span>\n </button>\n </div>\n <div class="modal-body row align-items-streach">\n <button class="btn wallet-provider p-4 metamask mr-2">\n <img src="./assets/pateners/metamask.svg" />\n <span class="formal text-info mt-2">MetaMask</span>\n </button>\n <button class="btn wallet-provider p-4 bsc">\n <img src="./assets/bsc-wallet.jpg" />\n <span class="formal text-info mt-2">BSC Wallet</span>\n </button>\n </div>\n </div>\n</div>\n</div>`),$("div.info").append(`<div class="card-body formal">\n<h4 class="card-title">Presale Info</h4>\n<div class="card-text">\n <p class="text-info text-left" style="font-size: 1.125em">${PEPETONE.RATIO}&nbsp;</p>\n <p class="text-right">${i.ratio} PEPE = 1 BNB</p>\n <hr />\n <p class="text-info text-left" style="font-size: 1.125em">${PEPETONE.MINMAX}</p>\n <p class="text-right">${i.min} BNB / ${i.max} BNB</p>\n</div>\n<div class="btn">${PEPETONE.PROGRESS}&nbsp;<span class="cur-presaled">0.0</span> BNB / ${i.required} BNB</div>\n<div class="progress" style="height: 0.5rem">\n <div\n class="progress-bar progress-bar-animated progress-bar-striped"\n role="progressbar"\n style="width: 25%"\n aria-valuenow="25"\n aria-valuemin="0"\n aria-valuemax="${i.required}"\n ></div>\n</div>\n</div>`),window.ethereum?.on("disconnect",(()=>N())),window.BinanceChain?.on("disconnect",(()=>N())),window.ethereum?.on("accountsChanged",(()=>N())),window.BinanceChain?.on("accountsChanged",(()=>N())),window.ethereum?.on("chainChanged",(()=>N())),window.BinanceChain?.on("chainChanged",(e=>N())),$((function(){N(),O.openOrNot()?(O.opend(),O.interval=setInterval(O.opend,1e3)):(O.notOpen(),O.interval=setInterval(O.notOpen,1e3)),f().catch((e=>{console.error(e),o(PEPETONE.ERRORS.NETWORK)}))})),$("button.metamask").on("click",(async()=>{try{l(window.ethereum);const e=(await window.ethereum.request({method:"eth_requestAccounts"}))[0];n.user=e,n.type=s,N(e)}catch(e){console.error(e),o("MetaMask"+PEPETONE.ERRORS.WALLET)}})),$("button.bsc").on("click",(async()=>{try{l(window.BinanceChain);const e=(await window.BinanceChain.requestAccounts())[0];n.user=e,n.type=a,N(e.addresses.filter((e=>"eth"==e.type))[0].address)}catch(e){console.error(e),o("BSC-Wallet"+PEPETONE.ERRORS.WALLET)}}))}PEPEWORKER();